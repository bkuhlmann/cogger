:toc: macro
:toclevels: 5
:figure-caption!:

:tone_link: link:https://alchemists.io/projects/tone[Tone]

= Cogger

Cogger is a portmanteau for colorized logging (i.e. `[c]olorized + l[ogger] = cogger`) which
decorates Ruby's native logger with colorized output.

toc::[]

== Features

- Decorates Ruby's default `Logger`.
- Uses color decoration as provided by the {tone_link} gem.

== Screenshot

image::https://alchemists.io/images/projects/cogger/screenshots/console.png[Console,width=552,height=679,role=focal_point]

== Requirements

. link:https://www.ruby-lang.org[Ruby].

== Setup

To set up the project, run:

[source,bash]
----
bin/setup
----

== Usage

All colorized logging is provided by `Cogger` which can be used as follows:

[source,ruby]
----
logger = Cogger.init

logger.debug "test"        # true
logger.debug { "test" }    # true
logger.info "test"         # true
logger.info { "test" }     # true
logger.warn "test"         # true
logger.warn { "test" }     # true
logger.error "test"        # true
logger.error { "test" }    # true
logger.fatal "test"        # true
logger.fatal { "test" }    # true
logger.unknown "test"      # true
logger.unknown { "test" }  # true
logger.any "test"          # true
logger.any { "test" }      # true
----

By default, all logging is configured to use `INFO` level and writes to `$stdout`. To see what the
colorized output from the above looks like, please see the screenshot shown in the _Screenshots_
section as documented earlier.

Beyond the standard log level methods, the following methods are also available:

[source,ruby]
----
logger = Cogger.init

logger.formatter  # #<Proc:0x000000010626ebc8 $HOME/OSS/cogger/lib/cogger/client.rb:37 (lambda)>
logger.level      # 1
logger.progname   # nil
----

=== Customization

Customization of the logger differs, slightly, from what you'd get with the standard `Logger` class.
The following sections will explain what these differences look like.

==== Initialization

For starters, the first argument is a positional argument that defaults to `Logger.new($stdout)` but
you could swap out the default logger with something that logs to a string. For example:

[source,ruby]
----
logger = Cogger.init Logger.new(StringIO.new)
----

You can also create a logger which might use custom colors. Example:

[source,ruby]
----
logger = Cogger.init color: MyColor.new
----

More information on how to customize your colors will be provided shortly. Lastly, you can provide any _setable_ attribute which would normally be used when constructing a
normal logger. Example:

[source,ruby]
----
logger = Cogger.init formatter: ->(severity, _at, _name, message) { "#{message}\n" },
                     level: :debug,
                     progname: "Test",
                     datetime_format: "%Y-%m-%d"
----

Alternatively, you can use a block as well:

[source,ruby]
----
logger = Cogger.init do |instance|
  instance.formatter = ->(severity, _at, _name, message) { "#{message}\n" }
  instance.level = :debug
  instance.progname = "Test"
  instance.datetime_format = "%Y-%m-%d"
end
----

==== Environment

The default log level is `INFO` but can be customized via your environment. For instance, you could
set the logging level to any of the following:

[source,bash]
----
export LOG_LEVEL=DEBUG
export LOG_LEVEL=INFO
export LOG_LEVEL=WARN
export LOG_LEVEL=ERROR
export LOG_LEVEL=FATAL
export LOG_LEVEL=UNKNOWN
export LOG_LEVEL=ANY
----

By default, `Cogger::Client` will automatically use whatever is set via the `LOG_LEVEL` environment
variable unless overwritten during initialization.

==== Colorization

Default colors are provided by the `Cogger::Color` class which are keyed by log level:

[source,ruby]
----
{
  debug: :white,
  info: :green,
  warn: :yellow,
  error: :red,
  fatal: %i[white bold on_red],
  unknown: %i[white bold],
  any: %i[white bold]
}
----

All keys require an array of styles which can then be decorated by {tone_link}. This means that if
you wanted to use custom colors, you could create a new instance of the `Color` class and inject it
into the client as follows:

[source,ruby]
----
tone = Tone.new.add debug: :white,
                    info: :green,
                    warn: :yellow,
                    error: :red,
                    fatal: %i[white bold on_red],
                    unknown: %i[white bold],
                    any: %i[white bold]
color = Cogger::Color.new decorator: tone
logger = Cogger.init color: custom_color
----

The above would ensure all log level colors are displayed on a black background. Basically, any
style accepted by `Tone#add` method is supported.

==== Testing

When testing the Cogger client, you might find it convenient to use `StringIO`, or a file, for
logging purposes in order to not pollute your test output but also have a convenient way to see what
was logged. Example:

[source,ruby]
----
class Demo
  def initialize logger: Cogger.init
    @logger = logger
  end

  def say(text) = logger.info { text }

  private

  attr_reader :logger
end

RSpec.describe Demo do
  subject(:demo) { described_class.new logger: }

  let(:logger) { Cogger.init Logger.new(StringIO.new) }

  describe "#say" do
    it "logs text" do
      demo.say "test"
      expect(logger.reread).to include("test")
    end
  end
end
----

Notice that when testing the instance of `Demo` and injecting a logger which logs to a string I/O
object, you can conveniently reread that string to see what was logged. This makes your specs easier
to write while also not adding additional noise to your test suite's output.

== Development

To contribute, run:

[source,bash]
----
git clone https://github.com/bkuhlmann/cogger
cd cogger
bin/setup
----

You can also use the IRB console for direct access to all objects:

[source,bash]
----
bin/console
----

== Tests

To test, run:

[source,bash]
----
bin/rake
----

== link:https://alchemists.io/policies/license[License]

== link:https://alchemists.io/policies/security[Security]

== link:https://alchemists.io/policies/code_of_conduct[Code of Conduct]

== link:https://alchemists.io/policies/contributions[Contributions]

== link:https://alchemists.io/projects/cogger/versions[Versions]

== link:https://alchemists.io/community[Community]

== Credits

* Built with link:https://alchemists.io/projects/gemsmith[Gemsmith].
* Engineered by link:https://alchemists.io/team/brooke_kuhlmann[Brooke Kuhlmann].
